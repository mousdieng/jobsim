<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Audit Logs</h1>
      <p class="mt-2 text-gray-600">Track all administrative actions on the platform</p>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Filters</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Action Type Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Action Type</label>
          <select
            [(ngModel)]="actionTypeFilter"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
          >
            <option value="">All Actions</option>
            <option value="suspend_user">Suspend User</option>
            <option value="unsuspend_user">Unsuspend User</option>
            <option value="ban_user">Ban User</option>
            <option value="approve_enterprise">Approve Enterprise</option>
            <option value="reject_enterprise">Reject Enterprise</option>
            <option value="suspend_enterprise">Suspend Enterprise</option>
            <option value="unsuspend_enterprise">Unsuspend Enterprise</option>
            <option value="validate_task">Validate Task</option>
            <option value="reject_task_validation">Reject Task Validation</option>
            <option value="flag_task">Flag Task</option>
            <option value="archive_task">Archive Task</option>
            <option value="feature_task">Feature Task</option>
            <option value="override_score">Override Score</option>
            <option value="flag_submission">Flag Submission</option>
          </select>
        </div>

        <!-- Target Type Filter -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Target Type</label>
          <select
            [(ngModel)]="targetTypeFilter"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
          >
            <option value="">All Types</option>
            <option value="user">Users</option>
            <option value="enterprise">Enterprises</option>
            <option value="task">Tasks</option>
            <option value="submission">Submissions</option>
          </select>
        </div>

        <!-- Limit -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Results Limit</label>
          <select
            [(ngModel)]="limit"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
          >
            <option [ngValue]="25">25</option>
            <option [ngValue]="50">50</option>
            <option [ngValue]="100">100</option>
            <option [ngValue]="200">200</option>
          </select>
        </div>

        <!-- Actions -->
        <div class="flex items-end space-x-2">
          <button
            (click)="applyFilters()"
            class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors"
          >
            Apply
          </button>
          <button
            (click)="clearFilters()"
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
      <p class="mt-4 text-gray-600">Loading audit logs...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
      <p class="text-red-800">{{ error }}</p>
    </div>

    <!-- Logs Table -->
    <div *ngIf="!loading" class="bg-white rounded-lg shadow overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Timestamp
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Admin
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Action
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Target
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Reason / Details
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Reversible
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let log of logs" class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ formatDate(log.created_at) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ log.admin_email }}</div>
                <div class="text-xs text-gray-500">{{ log.ip_address || 'Unknown IP' }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                  [ngClass]="getActionTypeBadge(log.action_type)"
                >
                  {{ getActionTypeLabel(log.action_type) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center space-x-2">
                  <span
                    class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                    [ngClass]="getTargetTypeBadge(log.target_type)"
                  >
                    {{ formatTargetType(log.target_type) }}
                  </span>
                  <span class="text-xs text-gray-500 font-mono">
                    {{ log.target_id.substring(0, 8) }}...
                  </span>
                </div>
              </td>
              <td class="px-6 py-4 text-sm text-gray-600 max-w-md">
                <div class="truncate" [title]="log.reason">
                  {{ log.reason }}
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <div *ngIf="log.reversible" class="flex items-center space-x-1">
                  <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="text-green-700 text-xs">
                    Until {{ formatDate(log.reversible_until!) }}
                  </span>
                </div>
                <div *ngIf="!log.reversible" class="flex items-center space-x-1">
                  <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  <span class="text-gray-500 text-xs">No</span>
                </div>
              </td>
            </tr>

            <tr *ngIf="logs.length === 0">
              <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                No audit logs found
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Results Count -->
      <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
        <p class="text-sm text-gray-600">
          Showing {{ logs.length }} audit log{{ logs.length !== 1 ? 's' : '' }}
        </p>
      </div>
    </div>

    <!-- Info Box -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">About Audit Logs</h3>
          <div class="mt-2 text-sm text-blue-700">
            <p>All administrative actions are logged for transparency and accountability. Reversible actions can be undone within the specified timeframe (typically 90 days). This ensures proper governance and allows for recovery from accidental actions.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
