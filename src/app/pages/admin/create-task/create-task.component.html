<div class="max-w-5xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Create New Task</h1>
    <p class="mt-2 text-sm text-gray-600">
      Fill in the details below to create a new task for candidates
    </p>
  </div>

  <!-- Success Message -->
  <div *ngIf="success" class="mb-6 rounded-md bg-green-50 p-4">
    <div class="flex">
      <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
      </svg>
      <div class="ml-3">
        <p class="text-sm font-medium text-green-800">Task created successfully! Redirecting...</p>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="mb-6 rounded-md bg-red-50 p-4">
    <div class="flex">
      <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
      </svg>
      <div class="ml-3">
        <p class="text-sm font-medium text-red-800">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="space-y-8">
    <!-- Basic Information -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h2>

      <div class="grid grid-cols-1 gap-6">
        <!-- Title -->
        <div>
          <label for="title" class="block text-sm font-medium text-gray-700">Task Title *</label>
          <input
            type="text"
            id="title"
            formControlName="title"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('title')"
            placeholder="e.g., Create a Social Media Marketing Campaign"
          />
          <p *ngIf="isFieldInvalid('title')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('title') }}
          </p>
        </div>

        <!-- Description -->
        <div>
          <label for="description" class="block text-sm font-medium text-gray-700">Description *</label>
          <textarea
            id="description"
            formControlName="description"
            rows="4"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('description')"
            placeholder="Brief overview of the task (min 20 characters)"
          ></textarea>
          <p *ngIf="isFieldInvalid('description')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('description') }}
          </p>
        </div>

        <!-- Instructions -->
        <div>
          <label for="instructions" class="block text-sm font-medium text-gray-700">Detailed Instructions *</label>
          <textarea
            id="instructions"
            formControlName="instructions"
            rows="6"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('instructions')"
            placeholder="Step-by-step instructions for completing this task (min 50 characters)"
          ></textarea>
          <p *ngIf="isFieldInvalid('instructions')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('instructions') }}
          </p>
        </div>
      </div>
    </div>

    <!-- Categorization -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Categorization</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Category -->
        <div>
          <label for="category" class="block text-sm font-medium text-gray-700">Category *</label>
          <select
            id="category"
            formControlName="category"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('category')"
          >
            <option value="">Select a category</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
          </select>
          <p *ngIf="isFieldInvalid('category')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('category') }}
          </p>
        </div>

        <!-- Job Role -->
        <div>
          <label for="job_role" class="block text-sm font-medium text-gray-700">Job Role *</label>
          <input
            type="text"
            id="job_role"
            formControlName="job_role"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('job_role')"
            placeholder="e.g., Marketing Manager, Sales Representative"
          />
          <p *ngIf="isFieldInvalid('job_role')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('job_role') }}
          </p>
        </div>

        <!-- Skill Tags -->
        <div class="md:col-span-2">
          <label for="skill_tags" class="block text-sm font-medium text-gray-700">Skill Tags *</label>
          <input
            type="text"
            id="skill_tags"
            formControlName="skill_tags"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('skill_tags')"
            placeholder="e.g., social_media, strategy, analytics (comma-separated)"
          />
          <p class="mt-1 text-sm text-gray-500">Enter skills separated by commas</p>
          <p *ngIf="isFieldInvalid('skill_tags')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('skill_tags') }}
          </p>
        </div>
      </div>
    </div>

    <!-- Difficulty & XP -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Difficulty & Rewards</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Difficulty -->
        <div>
          <label for="difficulty" class="block text-sm font-medium text-gray-700">Difficulty Level *</label>
          <select
            id="difficulty"
            formControlName="difficulty"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
          >
            <option *ngFor="let level of difficultyLevels" [value]="level">
              {{ level | titlecase }}
            </option>
          </select>
        </div>

        <!-- Base XP -->
        <div>
          <label for="base_xp" class="block text-sm font-medium text-gray-700">Base XP *</label>
          <input
            type="number"
            id="base_xp"
            formControlName="base_xp"
            min="100"
            max="1000"
            step="50"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            [class.border-red-500]="isFieldInvalid('base_xp')"
          />
          <p class="mt-1 text-sm text-gray-500">100-1000 XP</p>
          <p *ngIf="isFieldInvalid('base_xp')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('base_xp') }}
          </p>
        </div>

        <!-- Estimated Time -->
        <div>
          <label for="estimated_time_minutes" class="block text-sm font-medium text-gray-700">Est. Time (minutes)</label>
          <input
            type="number"
            id="estimated_time_minutes"
            formControlName="estimated_time_minutes"
            min="5"
            max="480"
            step="15"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
          />
          <p class="mt-1 text-sm text-gray-500">5-480 minutes</p>
        </div>
      </div>

      <!-- Max XP Preview -->
      <div class="mt-4 p-4 bg-indigo-50 rounded-md">
        <p class="text-sm font-medium text-indigo-900">
          Maximum XP (first attempt): <span class="text-lg">{{ calculateMaxXP() }} XP</span>
        </p>
        <p class="text-xs text-indigo-600 mt-1">
          Multiplier: {{ getDifficultyMultiplier(taskForm.get('difficulty')?.value) }}x (difficulty) Ã— 2.0x (first attempt)
        </p>
      </div>
    </div>

    <!-- Submission Requirements -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Submission Requirements</h2>

      <!-- Required Files -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-medium text-gray-700">Required Files *</h3>
          <button
            type="button"
            (click)="addRequiredFile()"
            class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200"
          >
            + Add File Requirement
          </button>
        </div>

        <div formArrayName="requiredFiles" class="space-y-4">
          <div
            *ngFor="let fileGroup of requiredFiles.controls; let i = index"
            [formGroupName]="i"
            class="border border-gray-200 rounded-md p-4"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Label *</label>
                <input
                  type="text"
                  formControlName="label"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  placeholder="e.g., Marketing Plan Document"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Type *</label>
                <select
                  formControlName="type"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                >
                  <option *ngFor="let type of fileTypes" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Allowed Formats *</label>
                <input
                  type="text"
                  formControlName="allowed_formats"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  placeholder="pdf, docx, txt"
                />
              </div>

              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="block text-sm font-medium text-gray-700">Max Size (MB) *</label>
                  <input
                    type="number"
                    formControlName="max_size_mb"
                    min="1"
                    max="50"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Max Files *</label>
                  <input
                    type="number"
                    formControlName="max_files"
                    min="1"
                    max="10"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  />
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700">Description *</label>
                <textarea
                  formControlName="description"
                  rows="2"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  placeholder="What should this file contain?"
                ></textarea>
              </div>
            </div>

            <button
              *ngIf="requiredFiles.length > 1"
              type="button"
              (click)="removeRequiredFile(i)"
              class="mt-3 text-sm text-red-600 hover:text-red-800"
            >
              Remove File Requirement
            </button>
          </div>
        </div>
      </div>

      <!-- Optional Files -->
      <div>
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-medium text-gray-700">Optional Files</h3>
          <button
            type="button"
            (click)="addOptionalFile()"
            class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200"
          >
            + Add Optional File
          </button>
        </div>

        <div formArrayName="optionalFiles" class="space-y-4">
          <div
            *ngFor="let fileGroup of optionalFiles.controls; let i = index"
            [formGroupName]="i"
            class="border border-gray-200 rounded-md p-4 bg-gray-50"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Label</label>
                <input
                  type="text"
                  formControlName="label"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Type</label>
                <select
                  formControlName="type"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                >
                  <option *ngFor="let type of fileTypes" [value]="type.value">
                    {{ type.label }}
                  </option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">Allowed Formats</label>
                <input
                  type="text"
                  formControlName="allowed_formats"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                />
              </div>

              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="block text-sm font-medium text-gray-700">Max Size (MB)</label>
                  <input
                    type="number"
                    formControlName="max_size_mb"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Max Files</label>
                  <input
                    type="number"
                    formControlName="max_files"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                  />
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea
                  formControlName="description"
                  rows="2"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                ></textarea>
              </div>
            </div>

            <button
              type="button"
              (click)="removeOptionalFile(i)"
              class="mt-3 text-sm text-red-600 hover:text-red-800"
            >
              Remove Optional File
            </button>
          </div>
        </div>

        <p *ngIf="optionalFiles.length === 0" class="text-sm text-gray-500 italic">
          No optional files. Click "Add Optional File" to add one.
        </p>
      </div>
    </div>

    <!-- Evaluation Criteria -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Evaluation Criteria</h2>

      <div>
        <label for="evaluation_criteria" class="block text-sm font-medium text-gray-700">
          Criteria *
        </label>
        <textarea
          id="evaluation_criteria"
          formControlName="evaluation_criteria"
          rows="6"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
          [class.border-red-500]="isFieldInvalid('evaluation_criteria')"
          placeholder="Enter each criterion on a new line:&#10;- Clear target audience definition&#10;- Creative and original approach&#10;- Well-structured plan"
        ></textarea>
        <p class="mt-1 text-sm text-gray-500">Enter each criterion on a new line</p>
        <p *ngIf="isFieldInvalid('evaluation_criteria')" class="mt-1 text-sm text-red-600">
          {{ getFieldError('evaluation_criteria') }}
        </p>
      </div>
    </div>

    <!-- Attachments -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Task Attachments (Optional)</h2>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Upload Files
        </label>
        <input
          type="file"
          multiple
          (change)="onAttachmentsSelected($event)"
          class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
        />
        <p class="mt-1 text-sm text-gray-500">
          Upload reference materials, examples, or resources for this task
        </p>
      </div>

      <!-- Attachment List -->
      <div *ngIf="taskAttachments.length > 0" class="mt-4 space-y-2">
        <div
          *ngFor="let file of taskAttachments; let i = index"
          class="flex items-center justify-between p-3 bg-gray-50 rounded-md"
        >
          <div class="flex items-center space-x-3">
            <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a1 1 0 112 0v4a7 7 0 11-14 0V7a5 5 0 0110 0v4a3 3 0 11-6 0V7a1 1 0 012 0v4a1 1 0 102 0V7a3 3 0 00-3-3z" clip-rule="evenodd"/>
            </svg>
            <div>
              <p class="text-sm font-medium text-gray-900">{{ file.name }}</p>
              <p class="text-xs text-gray-500">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</p>
            </div>
          </div>
          <button
            type="button"
            (click)="removeAttachment(i)"
            class="text-sm text-red-600 hover:text-red-800"
          >
            Remove
          </button>
        </div>
      </div>
    </div>

    <!-- Status -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Publication Status</h2>

      <div>
        <label for="status" class="block text-sm font-medium text-gray-700">Status *</label>
        <select
          id="status"
          formControlName="status"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
        >
          <option value="draft">Draft (not visible to candidates)</option>
          <option value="active">Active (visible to candidates)</option>
          <option value="archived">Archived (hidden from listing)</option>
        </select>
        <p class="mt-1 text-sm text-gray-500">
          Draft tasks can be edited before publishing
        </p>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-end space-x-4">
      <button
        type="button"
        (click)="cancel()"
        [disabled]="isSubmitting"
        class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="isSubmitting || uploadingAttachments"
        class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <span *ngIf="!isSubmitting && !uploadingAttachments">Create Task</span>
        <span *ngIf="uploadingAttachments">Uploading Attachments...</span>
        <span *ngIf="isSubmitting && !uploadingAttachments">Creating Task...</span>
      </button>
    </div>
  </form>
</div>
